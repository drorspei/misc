<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download & Extraction Timeline</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .control-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .control-group label {
            width: 150px;
            margin-right: 10px;
        }
        .control-group input[type="range"] {
            width: 300px;
            margin-right: 10px;
        }
        .control-group .value {
            width: 80px;
            font-weight: bold;
        }
        canvas {
            border: 1px solid #ccc;
            margin: 20px 0;
            display: block;
        }
        .total-time {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
        .file-size-readonly {
            font-size: 14px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Download & Extraction Timeline</h1>

    <div class="control-group">
        <label>Download speed:</label>
        <input type="range" id="downloadSpeed" min="100" max="400" step="25" value="225">
        <span class="value"><span id="downloadSpeedValue">225</span> MB/s</span>
    </div>

    <div class="control-group">
        <label>Extraction speed:</label>
        <input type="range" id="extractionSpeed" min="100" max="400" step="25" value="225">
        <span class="value"><span id="extractionSpeedValue">225</span> MB/s</span>
    </div>

    <div class="control-group">
        <label>File 1 size:</label>
        <input type="range" id="file1Size" min="0" max="2700" step="50" value="900">
        <span class="value"><span id="file1SizeValue">900</span> MB</span>
    </div>

    <div class="control-group">
        <label>File 2 size:</label>
        <input type="range" id="file2Size" min="0" max="2700" step="50" value="900">
        <span class="value"><span id="file2SizeValue">900</span> MB</span>
    </div>

    <div class="file-size-readonly">
        <label style="display: inline-block; width: 150px;">File 3 size:</label>
        <span id="file3SizeValue">900</span> MB
    </div>

    <canvas id="timeline" width="1000" height="400"></canvas>

    <div class="total-time">
        Total time: <span id="totalTime">0.00</span> seconds
    </div>

    <script>
        // Get all DOM elements
        const downloadSpeedSlider = document.getElementById('downloadSpeed');
        const extractionSpeedSlider = document.getElementById('extractionSpeed');
        const file1SizeSlider = document.getElementById('file1Size');
        const file2SizeSlider = document.getElementById('file2Size');

        const downloadSpeedValue = document.getElementById('downloadSpeedValue');
        const extractionSpeedValue = document.getElementById('extractionSpeedValue');
        const file1SizeValue = document.getElementById('file1SizeValue');
        const file2SizeValue = document.getElementById('file2SizeValue');
        const file3SizeValue = document.getElementById('file3SizeValue');
        const totalTimeValue = document.getElementById('totalTime');

        const canvas = document.getElementById('timeline');
        const ctx = canvas.getContext('2d');

        // Update display and redraw on any change
        function updateAll() {
            // Update displayed values
            downloadSpeedValue.textContent = downloadSpeedSlider.value;
            extractionSpeedValue.textContent = extractionSpeedSlider.value;
            file1SizeValue.textContent = file1SizeSlider.value;
            file2SizeValue.textContent = file2SizeSlider.value;

            // Calculate file 3 size
            const file1 = parseInt(file1SizeSlider.value);
            const file2 = parseInt(file2SizeSlider.value);
            const file3 = Math.max(0, 2700 - file1 - file2);
            file3SizeValue.textContent = file3;

            // Redraw timeline
            drawTimeline();
        }

        function drawTimeline() {
            // Get current values
            const downloadSpeed = parseInt(downloadSpeedSlider.value);
            const extractionSpeed = parseInt(extractionSpeedSlider.value);
            const file1Size = parseInt(file1SizeSlider.value);
            const file2Size = parseInt(file2SizeSlider.value);
            const file3Size = Math.max(0, 2700 - file1Size - file2Size);

            const files = [
                { size: file1Size, name: 'File 1' },
                { size: file2Size, name: 'File 2' },
                { size: file3Size, name: 'File 3' }
            ];

            // Calculate timeline events
            const events = calculateTimeline(files, downloadSpeed, extractionSpeed);

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate total time and time scale
            const totalTime = events.totalTime;
            const maxTime = Math.max(30, totalTime);

            // Canvas dimensions
            const leftMargin = 80;
            const rightMargin = 50;
            const topMargin = 40;
            const bottomMargin = 80;
            const rowHeight = 60;
            const timelineWidth = canvas.width - leftMargin - rightMargin;

            // Draw file labels
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';

            for (let i = 0; i < 3; i++) {
                const y = topMargin + i * rowHeight + rowHeight / 2;
                ctx.fillText(`File ${i + 1}`, leftMargin - 10, y);
            }

            // Draw timeline segments
            for (let i = 0; i < 3; i++) {
                const event = events.files[i];
                const y = topMargin + i * rowHeight + rowHeight / 2;
                const lineHeight = 20;

                // Draw download segment (blue)
                if (event.downloadStart !== null && event.downloadEnd !== null) {
                    const x1 = leftMargin + (event.downloadStart / maxTime) * timelineWidth;
                    const x2 = leftMargin + (event.downloadEnd / maxTime) * timelineWidth;

                    ctx.fillStyle = '#2196F3';
                    ctx.fillRect(x1, y - lineHeight / 2, x2 - x1, lineHeight);

                    ctx.strokeStyle = '#1976D2';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x1, y - lineHeight / 2, x2 - x1, lineHeight);
                }

                // Draw extraction segment (orange)
                if (event.extractionStart !== null && event.extractionEnd !== null) {
                    const x1 = leftMargin + (event.extractionStart / maxTime) * timelineWidth;
                    const x2 = leftMargin + (event.extractionEnd / maxTime) * timelineWidth;

                    ctx.fillStyle = '#FF9800';
                    ctx.fillRect(x1, y - lineHeight / 2, x2 - x1, lineHeight);

                    ctx.strokeStyle = '#F57C00';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x1, y - lineHeight / 2, x2 - x1, lineHeight);
                }
            }

            // Draw time axis
            const axisY = topMargin + 3 * rowHeight + 20;
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(leftMargin, axisY);
            ctx.lineTo(leftMargin + timelineWidth, axisY);
            ctx.stroke();

            // Draw time axis labels
            ctx.fillStyle = '#000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';

            const numTicks = 10;
            for (let i = 0; i <= numTicks; i++) {
                const time = (maxTime / numTicks) * i;
                const x = leftMargin + (time / maxTime) * timelineWidth;

                // Draw tick
                ctx.beginPath();
                ctx.moveTo(x, axisY);
                ctx.lineTo(x, axisY + 5);
                ctx.stroke();

                // Draw label
                ctx.fillText(time.toFixed(1) + 's', x, axisY + 10);
            }

            // Draw legend
            const legendY = axisY + 40;
            const legendX = leftMargin;

            // Download legend
            ctx.fillStyle = '#2196F3';
            ctx.fillRect(legendX, legendY, 30, 15);
            ctx.strokeStyle = '#1976D2';
            ctx.lineWidth = 1;
            ctx.strokeRect(legendX, legendY, 30, 15);

            ctx.fillStyle = '#000';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            ctx.fillText('Download', legendX + 35, legendY + 7.5);

            // Extraction legend
            const legendX2 = legendX + 120;
            ctx.fillStyle = '#FF9800';
            ctx.fillRect(legendX2, legendY, 30, 15);
            ctx.strokeStyle = '#F57C00';
            ctx.lineWidth = 1;
            ctx.strokeRect(legendX2, legendY, 30, 15);

            ctx.fillStyle = '#000';
            ctx.fillText('Extraction', legendX2 + 35, legendY + 7.5);

            // Update total time display
            totalTimeValue.textContent = totalTime.toFixed(2);
        }

        function calculateTimeline(files, downloadSpeed, extractionSpeed) {
            // Count non-zero files
            const activeFiles = files.filter(f => f.size > 0);
            const numDownloading = activeFiles.length;

            const results = {
                files: [],
                totalTime: 0
            };

            // Calculate download and extraction times
            let extractionEndTime = 0;

            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                if (file.size === 0) {
                    results.files.push({
                        downloadStart: null,
                        downloadEnd: null,
                        extractionStart: null,
                        extractionEnd: null
                    });
                    continue;
                }

                // Downloads happen in parallel with equal share of bandwidth
                const downloadTime = file.size / (downloadSpeed / numDownloading);
                const extractionTime = file.size / extractionSpeed;

                // Download starts at 0
                const downloadStart = 0;
                const downloadEnd = downloadTime;

                // Extraction starts when both:
                // 1. Download is complete
                // 2. Previous extraction is complete
                const extractionStart = Math.max(downloadEnd, extractionEndTime);
                const extractionEnd = extractionStart + extractionTime;

                results.files.push({
                    downloadStart,
                    downloadEnd,
                    extractionStart,
                    extractionEnd
                });

                extractionEndTime = extractionEnd;
            }

            // Total time is when the last extraction finishes
            results.totalTime = extractionEndTime;

            return results;
        }

        // Add event listeners
        downloadSpeedSlider.addEventListener('input', updateAll);
        extractionSpeedSlider.addEventListener('input', updateAll);
        file1SizeSlider.addEventListener('input', updateAll);
        file2SizeSlider.addEventListener('input', updateAll);

        // Initial draw
        updateAll();
    </script>
</body>
</html>
