<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download & Extraction Timeline</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .control-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
        }
        .control-group label {
            width: 150px;
            margin-right: 10px;
        }
        .control-group input[type="range"] {
            width: 300px;
            margin-right: 10px;
        }
        .control-group .value {
            width: 80px;
            font-weight: bold;
        }
        canvas {
            border: 1px solid #ccc;
            margin: 20px 0;
            display: block;
        }
        .total-time {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Download & Extraction Timeline</h1>

    <div class="control-group">
        <label>Download speed:</label>
        <input type="range" id="downloadSpeed" min="100" max="400" step="25" value="225">
        <span class="value" id="downloadSpeedValue">225 MB/s</span>
    </div>

    <div class="control-group">
        <label>Extraction speed:</label>
        <input type="range" id="extractionSpeed" min="100" max="400" step="25" value="225">
        <span class="value" id="extractionSpeedValue">225 MB/s</span>
    </div>

    <div class="control-group">
        <label>File 1 size:</label>
        <input type="range" id="file1Size" min="0" max="2700" step="25" value="900">
        <span class="value" id="file1SizeValue">900 MB</span>
    </div>

    <div class="control-group">
        <label>File 2 size:</label>
        <input type="range" id="file2Size" min="0" max="2700" step="25" value="900">
        <span class="value" id="file2SizeValue">900 MB</span>
    </div>

    <div class="control-group">
        <label>File 3 size:</label>
        <span class="value" id="file3SizeValue">900 MB</span>
    </div>

    <canvas id="timeline" width="1000" height="300"></canvas>

    <div class="total-time">Total time: <span id="totalTimeValue">0.00</span> seconds</div>

    <script>
        const canvas = document.getElementById('timeline');
        const ctx = canvas.getContext('2d');

        const downloadSpeedSlider = document.getElementById('downloadSpeed');
        const extractionSpeedSlider = document.getElementById('extractionSpeed');
        const file1SizeSlider = document.getElementById('file1Size');
        const file2SizeSlider = document.getElementById('file2Size');

        function updateValues() {
            document.getElementById('downloadSpeedValue').textContent = downloadSpeedSlider.value + ' MB/s';
            document.getElementById('extractionSpeedValue').textContent = extractionSpeedSlider.value + ' MB/s';
            document.getElementById('file1SizeValue').textContent = file1SizeSlider.value + ' MB';
            document.getElementById('file2SizeValue').textContent = file2SizeSlider.value + ' MB';

            const file1 = parseInt(file1SizeSlider.value);
            const file2 = parseInt(file2SizeSlider.value);
            const file3 = Math.max(0, 2700 - file1 - file2);
            document.getElementById('file3SizeValue').textContent = file3 + ' MB';

            drawTimeline();
        }

        function calculateDownloadEndTimes(sizes, totalDownloadSpeed) {
            // Sort files by size with their original indices
            const files = sizes.map((size, idx) => ({size, idx}));
            const sortedSizes = [...sizes].sort((a, b) => a - b);

            const downloadEndTimes = [0, 0, 0];
            let currentTime = 0;
            let remainingSizes = [...sizes];
            let activeDownloads = 3;

            // Filter out zero-sized files
            const nonZeroFiles = files.filter(f => f.size > 0);
            if (nonZeroFiles.length === 0) {
                return [0, 0, 0];
            }

            activeDownloads = nonZeroFiles.length;

            // Process files in order of completion
            const sorted = [...nonZeroFiles].sort((a, b) => a.size - b.size);

            for (let i = 0; i < sorted.length; i++) {
                const file = sorted[i];
                const speedPerFile = totalDownloadSpeed / activeDownloads;
                const timeToDownload = remainingSizes[file.idx] / speedPerFile;

                currentTime += timeToDownload;
                downloadEndTimes[file.idx] = currentTime;

                // Update remaining sizes for all active files
                for (let j = 0; j < remainingSizes.length; j++) {
                    if (remainingSizes[j] > 0) {
                        remainingSizes[j] -= speedPerFile * timeToDownload;
                        if (remainingSizes[j] < 0.001) remainingSizes[j] = 0;
                    }
                }

                activeDownloads--;
            }

            return downloadEndTimes;
        }

        function drawTimeline() {
            const downloadSpeed = parseInt(downloadSpeedSlider.value);
            const extractionSpeed = parseInt(extractionSpeedSlider.value);
            const file1 = parseInt(file1SizeSlider.value);
            const file2 = parseInt(file2SizeSlider.value);
            const file3 = Math.max(0, 2700 - file1 - file2);

            const fileSizes = [file1, file2, file3];

            // Calculate download end times
            const downloadEndTimes = calculateDownloadEndTimes(fileSizes, downloadSpeed);

            // Calculate extraction times
            const extractionTimes = fileSizes.map(size => size / extractionSpeed);

            // Calculate extraction start and end times
            const extractionStartTimes = [0, 0, 0];
            const extractionEndTimes = [0, 0, 0];

            // File 1: extraction starts right after download
            extractionStartTimes[0] = downloadEndTimes[0];
            extractionEndTimes[0] = extractionStartTimes[0] + extractionTimes[0];

            // File 2: extraction starts after file 1 extraction ends AND file 2 download ends
            extractionStartTimes[1] = Math.max(downloadEndTimes[1], extractionEndTimes[0]);
            extractionEndTimes[1] = extractionStartTimes[1] + extractionTimes[1];

            // File 3: extraction starts after file 2 extraction ends AND file 3 download ends
            extractionStartTimes[2] = Math.max(downloadEndTimes[2], extractionEndTimes[1]);
            extractionEndTimes[2] = extractionStartTimes[2] + extractionTimes[2];

            const totalTime = Math.max(extractionEndTimes[0], extractionEndTimes[1], extractionEndTimes[2]);
            document.getElementById('totalTimeValue').textContent = totalTime.toFixed(2);

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate scale
            const maxTime = Math.max(30, totalTime * 1.1);
            const timeScale = 900 / maxTime; // pixels per second
            const leftMargin = 80;
            const rowHeight = 60;
            const barHeight = 20;

            // Draw rows
            for (let i = 0; i < 3; i++) {
                const y = 20 + i * rowHeight;

                // Draw file label
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(`File ${i + 1}:`, leftMargin - 10, y + barHeight / 2 + 5);

                if (fileSizes[i] === 0) continue;

                // Draw download bar (blue)
                ctx.fillStyle = '#4285f4';
                const downloadWidth = downloadEndTimes[i] * timeScale;
                ctx.fillRect(leftMargin, y, downloadWidth, barHeight);

                // Draw extraction bar (orange)
                ctx.fillStyle = '#ff9800';
                const extractionX = leftMargin + extractionStartTimes[i] * timeScale;
                const extractionWidth = extractionTimes[i] * timeScale;
                ctx.fillRect(extractionX, y, extractionWidth, barHeight);

                // Draw borders
                ctx.strokeStyle = '#333';
                ctx.strokeRect(leftMargin, y, downloadWidth, barHeight);
                ctx.strokeRect(extractionX, y, extractionWidth, barHeight);
            }

            // Draw time axis
            const axisY = 20 + 3 * rowHeight + 20;
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(leftMargin, axisY);
            ctx.lineTo(leftMargin + maxTime * timeScale, axisY);
            ctx.stroke();

            // Draw time markers
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            const numMarkers = 10;
            const markerInterval = maxTime / numMarkers;

            for (let i = 0; i <= numMarkers; i++) {
                const time = i * markerInterval;
                const x = leftMargin + time * timeScale;

                ctx.beginPath();
                ctx.moveTo(x, axisY);
                ctx.lineTo(x, axisY + 5);
                ctx.stroke();

                ctx.fillStyle = '#000';
                ctx.fillText(time.toFixed(1) + 's', x, axisY + 20);
            }

            // Draw legend
            const legendY = axisY + 45;
            ctx.fillStyle = '#4285f4';
            ctx.fillRect(leftMargin, legendY, 30, 15);
            ctx.fillStyle = '#000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Download', leftMargin + 35, legendY + 12);

            ctx.fillStyle = '#ff9800';
            ctx.fillRect(leftMargin + 120, legendY, 30, 15);
            ctx.fillStyle = '#000';
            ctx.fillText('Extraction', leftMargin + 155, legendY + 12);
        }

        // Add event listeners
        downloadSpeedSlider.addEventListener('input', updateValues);
        extractionSpeedSlider.addEventListener('input', updateValues);
        file1SizeSlider.addEventListener('input', updateValues);
        file2SizeSlider.addEventListener('input', updateValues);

        // Initial draw
        updateValues();
    </script>
</body>
</html>
